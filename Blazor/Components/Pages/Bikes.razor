@page "/bikes"
@inject BikeService BikeService // Inject the BikeService to access bike data from the database.
@rendermode InteractiveServer //means the page will be interactive and run on the server, sending updates to the client.
@using Blazor.Services
@using Blazor.Models
@inject NavigationManager NavigationManager

<h3>Bikes</h3>

<div class="filters mb-4">
    @*A container for filter inputs.*@
    <input placeholder="Brand"
           @bind="brandFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
    <input placeholder="Type"
           @bind="typeFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
    <input type="number"
           placeholder="Max Price"
           @bind="maxPriceFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
    <input type="number"
           placeholder="Model Year"
           @bind="modelYearFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
    <input placeholder="Color"
           @bind="colorFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />

    <input placeholder="Location"
           @bind="locationFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />

    <select @bind="conditionFilter"
            @bind:event="onchange"
            @bind:after="LoadBikes"
            class="form-control mb-2">
        <option value="">All Conditions</option>
        <option value="New">New</option>
        <option value="Used">Used</option>
    </select>
</div>

@if (bikeList == null)
{
    <p>Loading bikes...</p>
}
else if (!bikeList.Any())
{
    <p>No bikes found matching these filters.</p>
}
else
{
    <div class="bikes-container">
        @foreach (var bike in bikeList)
        {
            <SaleCard Bike="bike" />
        }
    </div>
}

@code {

    public Bike? bike { get; set; }

    private void OpenSalesCard(int bikeId)
    {
        NavigationManager.NavigateTo($"/saledetail/{bikeId}");
    }
    private List<Bike>? bikeList;

    private string brandFilter = string.Empty;
    private string typeFilter = string.Empty;
    private decimal? maxPriceFilter;
    private int? modelYearFilter;
    private string conditionFilter = string.Empty;
    private string colorFilter = string.Empty;
    private string locationFilter = string.Empty;

    protected override void OnInitialized()
    {
        LoadBikes();
    }

    private void LoadBikes()
    {
        bikeList = BikeService.GetBikes(
            brandFilter,
            typeFilter,
            colorFilter,
            locationFilter,
            maxPriceFilter,
            modelYearFilter,
            conditionFilter
        );
    }

}


