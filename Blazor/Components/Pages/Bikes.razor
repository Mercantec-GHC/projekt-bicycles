@page "/bikes"
@inject BikeService BikeService // Inject the BikeService to access bike data from the database.
@rendermode InteractiveServer //means the page will be interactive and run on the server, sending updates to the client.
@using Blazor.Services
@using Blazor.Models
@inject NavigationManager NavigationManager

<h3>Bikes</h3>

<div class="filters mb-4">
    @*A container for filter inputs.*@
    <!-- bind="brandFilter": binds the input value to the brandFilter property. -->
    <input placeholder="Brand" 
           @bind="brandFilter" 
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
        <select @bind="typeFilter" @bind:event="oninput" @bind:after="LoadBikes" class="form-control mb-2">
        <option value="">All Types</option>
        <option value="Mountain">Mountain</option>
        <option value="City">City</option>
        <option value="Electric">Electric</option>
        <option value="Road">Road</option>
        </select>
           
          <input type="number"
           placeholder="Max Price"
           @bind="maxPriceFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
    <input type="number"
           placeholder="Model Year"
           @bind="modelYearFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />
    <input placeholder="Color"
           @bind="colorFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />

    <input placeholder="Location"
           @bind="locationFilter"
           @bind:event="oninput"
           @bind:after="LoadBikes"
           class="form-control mb-2" />

    <select @bind="conditionFilter"
            @bind:event="onchange"
            @bind:after="LoadBikes"
            class="form-control mb-2">
        <option value="">All Conditions</option>
        <option value="New">New</option>
        <option value="Used">Used</option>
    </select>
</div>

@if (bikeList == null) // Displays a message while bikes are being loaded.
{
    <p>Loading bikes...</p>
}
else if (!bikeList.Any()) // Displays a message if no bikes match the filters.
{
    <p>No bikes found matching these filters.</p>
}
else
{
    <div class="bikes-container">
        @foreach (var bike in bikeList) // Iterates through bikeList and displays each bike in a SaleCard component.
        {
            <SaleCard Bike="bike" />
            // SaleCard is a reusable component that shows details of a bike.
        }
    </div>
}
@code {

    public Bike? bike { get; set; } // Property to hold a single bike instance.

    private void OpenSalesCard(int bikeId) //Method to navigate to the detail page of a bike by ID.
    {
        NavigationManager.NavigateTo($"/saledetail/{bikeId}"); //Navigates to the sale detail page for the specified bike ID.
    }
    private List<Bike>? bikeList; // Holds the list of bikes currently loaded from BikeService.

    private string brandFilter = string.Empty;
    private string typeFilter = string.Empty;
    private decimal? maxPriceFilter; //Nullable types (decimal?, int?) allow empty input.
    private int? modelYearFilter;
    private string conditionFilter = string.Empty;
    private string colorFilter = string.Empty;
    private string locationFilter = string.Empty;

    protected override void OnInitialized()
    {
        LoadBikes();
    }

    private void LoadBikes() //Loads bikes from BikeService applying current filter values.
    {
        bikeList = BikeService.GetBikes( //Calls GetBikes method of BikeService with filter parameters.
            brandFilter, // Passes current filter values to the service.
            typeFilter,
            colorFilter,
            locationFilter,
            maxPriceFilter,
            modelYearFilter,
            conditionFilter
        );
    }

}


