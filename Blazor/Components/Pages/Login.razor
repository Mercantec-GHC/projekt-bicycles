@page "/login"
@using Blazor.Services
@using Microsoft.AspNetCore.Components.Authorization
@using Npgsql

@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider Auth
@inject Blazor.Services.DbConfig DbConfig

<h3>Login</h3>

<div class="signup-container">
    @if (!string.IsNullOrEmpty(Error))
    {
        <div class="error-message">@Error</div>
    }

    <input class="signup-input" @bind="Email" placeholder="Email" type="email" />
    <input class="signup-input" @bind="Password" placeholder="Password" type="password" />
    <button class="signup-button" @onclick="DoLogin">Login</button>
</div>

@code {
    string Email = "";
    string Password = "";
    string Error = "";

    private async Task DoLogin()
    {
        Error = "";

        if (string.IsNullOrWhiteSpace(Email) || string.IsNullOrWhiteSpace(Password))
        {
            Error = "Enter email and password";
            return;
        }

        var authProvider = (SimpleDbAuthProvider)Auth;
        var ok = await authProvider.Login(Email, Password);

        if (!ok)
        {
            Error = "Invalid email or password";
            return;
        }

        NavigationManager.NavigateTo("/");
    }
}
