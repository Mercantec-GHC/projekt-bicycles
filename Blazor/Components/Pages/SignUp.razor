@page "/signup"
@using Blazor.Services
@using Microsoft.AspNetCore.Components.Authorization
@using Npgsql

@inject NavigationManager NavigationManager     // Used to redirect user after signup,
@inject AuthenticationStateProvider Auth        // Injected auth provider (base type)
@inject UserService UserService                 // Service to handle user-related operations.

<h3 style="text-align: center;">Sign Up</h3>

<div class="signup-container">
    @if (!string.IsNullOrEmpty(Error))
    {
        <!-- Display validation or database errors -->
        <div class="error-message">@Error</div>
    }

    <!-- Name input -->
    <input class="signup-input" @bind="Name" placeholder="Name" />

    <!-- Email input -->
    <input class="signup-input" @bind="Email" placeholder="Email" type="email" />

    <!-- Password input -->
    <input class="signup-input" @bind="Password" placeholder="Password" type="password" />

    <!-- Signup button -->
    <button class="signup-button" @onclick="DoSignUp">Sign Up</button>
</div>

@code {
    string Name = "";
    string Email = "";
    string Password = "";
    string Error = "";

    private async Task DoSignUp()
    {
        Error = "";

        if (string.IsNullOrWhiteSpace(Name) ||
            string.IsNullOrWhiteSpace(Email) ||
            string.IsNullOrWhiteSpace(Password))
        {
            Error = "All fields are required";
            return;
        }

        var success = await UserService.SignUpAsync(Name, Email, Password);

        if (!success)
        {
            Error = "Email already registered";
            return;
        }

        var authProvider = (SimpleDbAuthProvider)Auth;
        await authProvider.Login(Email, Password);

        NavigationManager.NavigateTo("/");
    }
}

