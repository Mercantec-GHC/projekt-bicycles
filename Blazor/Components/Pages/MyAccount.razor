@page "/my-account"
@using Blazor.Models
@using Blazor.Services
@inject SimpleDbAuthProvider AuthProvider
@inject BikeService BikeService
@inject NavigationManager Navigation
@rendermode InteractiveServer
@inject UserService UserService

<h2>My Account</h2>

@if (CurrentUser == null)
{
    <p>Loading user info...</p>
}
else
{
    <div>
        <p><strong>Name:</strong> @CurrentUser.Name</p>
        <p><strong>Email:</strong> @CurrentUser.Email</p>
        <p><strong>Phone:</strong> @CurrentUser.Phone</p>
    </div>

    @if (UserBikes == null)
    {
        <p>Loading bikes...</p>
    }
    else if (!UserBikes.Any())
    {
        <p>You have not created any ads yet.</p>
    }
    else
    {
        <h3>My Ads</h3>
        @foreach (var bike in UserBikes)
        {
            <SaleCard Bike="bike" />
        }
    }
}

@code {
    private User? CurrentUser;
    private List<Bike>? UserBikes;

    protected override async Task OnInitializedAsync()
    {
        var userId = AuthProvider.CurrentUserId;

        // Fetch user info
        CurrentUser = await UserService.GetUserByIdAsync(userId);

        // Fetch user bikes
        UserBikes = await UserService.GetUserBikesAsync(userId);
    }
}