@page "/my-account"
@using Blazor.Models
@using Blazor.Services
@inject SimpleDbAuthProvider AuthProvider
@inject BikeService BikeService
@inject NavigationManager Navigation
@rendermode InteractiveServer
@inject UserService UserService

<h2 style="font-size: 2em; font-weight: bold; margin-bottom: 20px; color: #333;">My Account</h2>

@if (CurrentUser == null)
{
    <p style="color: #666;">Loading user info...</p>
}
else
{
    <!-- User info card -->
    <div style="background-color: #d1fae5; /* light green */
                    border-radius: 12px;
                    padding: 24px;
                    max-width: 500px;
                    margin-bottom: 30px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h3 style="font-size: 1.4em; font-weight: bold; margin-bottom: 16px; color: #065f46;">User Information</h3>
        <p style="margin-bottom: 8px;"><strong>Name:</strong> @CurrentUser.Name</p>
        <p style="margin-bottom: 8px;"><strong>Email:</strong> @CurrentUser.Email</p>
        <p style="margin-bottom: 8px;"><strong>Phone:</strong> @CurrentUser.Phone</p>
        <p style="margin-bottom: 8px;"><strong>Created At:</strong> @CurrentUser.CreatedAt.ToString("dd MMM yyyy")</p>
    </div>

    <!-- User bikes -->
    @if (UserBikes == null)
    {
        <p style="color: #666;">Loading bikes...</p>
    }
    else if (!UserBikes.Any())
    {
        <p style="color: #666;">You have not created any ads yet.</p>
    }
    else
    {
        <h3 style="font-size: 1.4em; font-weight: bold; margin-bottom: 16px; color: #333;">My Ads</h3>
        <div class="bikes-container">
        @foreach (var bike in UserBikes)
        {
            <SaleCard Bike="bike" />
        }
        </div>
    }
}

@code {
    private User? CurrentUser;
    private List<Bike>? UserBikes;

    protected override async Task OnInitializedAsync()
    {
        var userId = AuthProvider.CurrentUserId;

        // Fetch user info
        CurrentUser = await UserService.GetUserByIdAsync(userId);

        // Fetch user bikes
        UserBikes = await UserService.GetUserBikesAsync(userId);
    }
}
